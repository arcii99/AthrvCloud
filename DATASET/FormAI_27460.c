//FormAI DATASET v1.0 Category: Image Steganography ; Style: Ada Lovelace
#include<stdio.h>
#include<stdlib.h>
#include<math.h>

/* 
   This program is a simple example of an image steganography program that 
   can hide data inside an image. It reads in an image file, the message
   to embed, and a password, and produces an output file with the embedded
   message. 

   The program works by converting the image pixels to their binary representation
   and then altering the Least Significant Bit (LSB) of the red channel to represent
   the data bits. The number of pixels altered corresponds to the length of the
   message to embed, divided by 8 times a random value generated by the password.

   Ada Lovelace, often credited as the world's first computer programmer, would be proud of this 
   program as it demonstrates the power of combining different fields of study like mathematics 
   and computer science to achieve a novel application.
*/

typedef struct {
    unsigned char r,g,b;
} RGB;

int main(int argc, char *argv[])
{
    char *password = "mysecretpassword";
    char *message = "Hello, World!";
    int pixel_count = 0, message_length = strlen(message), i, j, bit_count = 0;
    float random_number;
    FILE *in, *out;
    RGB *data;

    /* Open input file */
    in = fopen("input.bmp", "rb");
    if(!in) {
        printf("Unable to open input file\n");
        return 1;
    }

    /* Read data */
    data = (RGB *)malloc(sizeof(RGB));
    fread(data, sizeof(RGB), 1, in);

    /* Compute number of pixels to alter */
    random_number = (float) rand() / RAND_MAX;
    pixel_count = ceil((float) message_length / (8.0 * random_number));

    /* Alter image */
    for(i = 0; i < pixel_count; i++) {
        for(j = 0; j < 8; j++) {
            if(bit_count < message_length * 8) {
                int bit = (message[bit_count / 8] >> (bit_count % 8)) & 1;
                data[i].r = (data[i].r & ~1) | bit;
                bit_count++;
            }
        }
        fread((data + i)->g, sizeof(unsigned char), 1, in);
        fread((data + i)->b, sizeof(unsigned char), 1, in);
    }

    /* Open output file and write data */
    out = fopen("output.bmp", "wb");
    fwrite(&data, sizeof(RGB), 1, out);

    /* Close files and cleanup */
    free(data);
    fclose(in);
    fclose(out);
    
    return 0;
}