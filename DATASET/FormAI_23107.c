//FormAI DATASET v1.0 Category: Interprocess communication ; Style: mathematical
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/shm.h>
#include <sys/stat.h>

#define MAX_SEQUENCE 10

typedef struct {
    long fib_sequence[MAX_SEQUENCE];
    int sequence_size;
} shared_data;

void generate_fib_sequence(int n, long* sequence) {
    sequence[0] = 0;
    sequence[1] = 1;
    for(int i=2; i<=n; i++) {
        sequence[i] = sequence[i-1] + sequence[i-2];
    }
}

int main() {
    pid_t pid;
    int shm_id;
    shared_data* data;
    const int SIZE = sizeof(shared_data);
    const int KEY = 123456;
    
    // Create shared memory segment
    shm_id = shmget(KEY, SIZE, IPC_CREAT | 0666);
    if(shm_id < 0) {
        perror("shmget error\n");
        exit(1);
    }
    
    // Attach to shared memory segment
    data = (shared_data*) shmat(shm_id, NULL, 0);
    if(data == (shared_data*)-1) {
        perror("shmat error\n");
        exit(1);
    }

    printf("Enter the size of Fibonacci sequence to generate (<= %d): ", MAX_SEQUENCE);
    scanf("%d", &data->sequence_size);

    pid = fork();
    if(pid == 0) {
        // Child process
        generate_fib_sequence(data->sequence_size, data->fib_sequence);

        // Detach from shared memory segment
        if(shmdt(data) == -1) {
            perror("shmdt error\n");
            exit(1);
        }
    } else if(pid > 0) {
        // Parent process
        wait(NULL);
        
        printf("Fibonacci sequence generated by child process:\n");
        for(int i=0; i<=data->sequence_size; i++) {
            printf("%ld ", data->fib_sequence[i]);
        }
        printf("\n");
        
        // Detach from shared memory segment
        if(shmdt(data) == -1) {
            perror("shmdt error\n");
            exit(1);
        }
        
        // Deallocate shared memory segment
        shmctl(shm_id, IPC_RMID, NULL);
    } else {
        // Fork failed
        perror("fork error\n");
        exit(1);
    }

    return 0;
}